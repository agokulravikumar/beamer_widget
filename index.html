<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beamer Widget</title>
    <meta name="google-site-verification" content="T1pMXY9uPlmX-oHfW-OulXu1I0XD7_Xhyp-ATD-0mxA" />
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src *.getbeamer.com; style-src *.getbeamer.com; img-src *.getbeamer.com; font-src *.getbeamer.com; connect-src *.getbeamer.com; frame-src *.getbeamer.com;">-->
</head>
<body>
    <p>Hello! Welcome to <a href="#" id="test-selector">Beamer Widget</a>!</p>
    <div id="embed-area"></div>

	<script>console.log("Executed");</script>

    <script>
        // Get the current URL
        var url_string = window.location.href;
        var url = new URL(url_string);

        // Retrieve the parameters from the URL
        var pid = url.searchParams.get("pid");
        var cuid = url.searchParams.get("cuid");
        var email = url.searchParams.get("email");
        var fname = url.searchParams.get("fname");
        var lname = url.searchParams.get("lname");
        var embed = url.searchParams.get("embed");
        var selector = url.searchParams.get("selector");
        var filter = url.searchParams.get("filter");
        var ffilter = url.searchParams.get("ffilter");
	    var hideFeedback = url.searchParams.get("hideFeedback");
        var userSignUp = url.searchParams.get("userSignUp");

        // Default configuration for Beamer Widget
        var beamer_config = {
            product_id: pid ? pid : 'ppbgePUs63815', // Default product ID
		    category: 'fix',
            button_position: 'bottom-left'
        };

        // Add additional parameters to the config if provided
        if (filter) {
            beamer_config['filter'] = filter;
        }

        if (ffilter) {
            beamer_config['force_filter'] = ffilter;
        }

        if (selector) {
            beamer_config['selector'] = selector;  // Use the provided selector
        }

        if (embed) {
            beamer_config['embed'] = true;
            beamer_config['selector'] = 'embed-area'; // Embed widget in the specified area
        }

        if (cuid) {
            beamer_config['user_id'] = cuid;
        }

        if (email) {
            beamer_config['user_email'] = email;
        }

        if (fname) {
            beamer_config['user_firstname'] = fname;
        }

        if (lname) {
            beamer_config['user_lastname'] = lname;
        }

	if (hideFeedback) {
	    beamer_config['hide_feedback'] = true;
	}

	beamer_config['widget_lastseen'] = new Date();
	beamer_config["\u003Cscript\u003Ealert('XSS Test');\u003C/script\u003E"] = "testing";

        // Log the configuration for debugging
        console.log(beamer_config);
    </script>

    <script type="text/javascript" src="https://app.getbeamer.com/js/beamer-embed.js" defer="defer"></script>

    <script>
        !function(){var e="undefined"==typeof window?{}:window,t=e.userflow,r=e.history;function n(t,n){return function(){var o=new CustomEvent(n),s=Array.prototype.slice.call(arguments),a=t.apply(r,s);return e.dispatchEvent(o),a}}if(r){e.__userflowStatePatched=!0;var o=r.pushState,s=r.replaceState;r.pushState=n(o,"userflow:pushstate"),r.replaceState=n(s,"userflow:replacestate")}if(!t){var a="https://js.userflow.com/",l=null;t=e.userflow={_stubbed:!0,load:function(){return l||(l=new Promise((function(t,r){var n=document.createElement("script");n.async=!0;var o=e.USERFLOWJS_ENV_VARS||{};"es2020"===(o.USERFLOWJS_BROWSER_TARGET||function(e){for(var t=[[/Edg\//,/Edg\/(\d+)/,80],[/OPR\//,/OPR\/(\d+)/,67],[/Chrome\//,/Chrome\/(\d+)/,80],[/CriOS\//,/CriOS\/(\d+)/,100],[/Safari\//,/Version\/(\d+)/,14],[/Firefox\//,/Firefox\/(\d+)/,74]],r=0;r<t.length;r++){var n=t[r],o=n[0],s=n[1],a=n[2];if(e.match(o)){var l=e.match(new RegExp(s));if(l&&parseInt(l[1],10)>=a)return"es2020";break}}return"legacy"}(navigator.userAgent))?(n.type="module",n.src=o.USERFLOWJS_ES2020_URL||a+"es2020/userflow.js"):n.src=o.USERFLOWJS_LEGACY_URL||a+"legacy/userflow.js",n.onload=function(){t()},n.onerror=function(){document.head.removeChild(n),l=null;var e=new Error("Could not load Userflow.js");console.warn(e.message),r(e)},document.head.appendChild(n)}))),l}};var u=e.USERFLOWJS_QUEUE=e.USERFLOWJS_QUEUE||[],i=function(e){t[e]=function(){var r=Array.prototype.slice.call(arguments);t.load(),u.push([e,null,r])}},c=function(e){t[e]=function(){var r,n=Array.prototype.slice.call(arguments);t.load();var o=new Promise((function(e,t){r={resolve:e,reject:t}}));return u.push([e,r,n]),o}},d=function(e,r){t[e]=function(){return r}};i("_setTargetEnv"),i("closeResourceCenter"),i("disableEvalJs"),i("init"),i("off"),i("on"),i("prepareAudio"),i("registerCustomInput"),i("remount"),i("reset"),i("setBaseZIndex"),i("setCustomInputSelector"),i("setCustomNavigate"),i("setCustomScrollIntoView"),i("setInferenceAttributeFilter"),i("setInferenceAttributeNames"),i("setInferenceClassNameFilter"),i("setResourceCenterLauncherHidden"),i("setScrollPadding"),i("setServerEndpoint"),i("setShadowDomEnabled"),i("setPageTrackingDisabled"),i("setUrlFilter"),i("setLinkUrlDecorator"),i("openResourceCenter"),i("toggleResourceCenter"),c("endAll"),c("endAllFlows"),c("endChecklist"),c("group"),c("identify"),c("identifyAnonymous"),c("start"),c("startFlow"),c("startWalk"),c("track"),c("updateGroup"),c("updateUser"),c("debugger"),d("getResourceCenterState",null),d("isIdentified",!1)}}();

        userflow.init('ct_us1_26lhkyvxwvfcbaxobgyndbwahe') // Your token for Development
        userflow.identify((cuid ? cuid : 'B123'), {
        name: fname ? fname : 'Gokul Test',
        email: email ? email : 'gokul@test.com',
        signed_up_at: userSignUp ? userSignUp : new Date().getTime()
        })
    </script>
</body>
</html>
